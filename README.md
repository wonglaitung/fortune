# 金融信息监控与智能交易系统

一个基于 Python 的综合性金融分析系统，集成多数据源、技术分析工具和大模型智能判断，为投资者提供全面的市场分析和交易策略验证工具。

## 项目简介

本项目旨在帮助投资者：
- 📊 实时监控加密货币、港股、黄金等金融市场
- 🔍 识别主力资金动向和交易信号
- 🤖 基于大模型进行智能投资决策和持仓分析
- 📈 验证交易策略的有效性
- 💰 获取股息信息和基本面数据
- 📧 自动邮件通知重要信息

## 核心功能

### 数据获取与监控
- **加密货币监控**：比特币、以太坊价格和技术分析（每小时）
- **港股IPO信息**：最新IPO信息（每天）
- **黄金市场分析**：黄金价格和投资建议（每小时）
- **恒生指数监控**：价格、技术指标、交易信号（交易时段）
- **美股市场数据**：标普500、纳斯达克、VIX、美国国债收益率
- **基本面数据**：财务指标、利润表、资产负债表、现金流量表
- **股息信息**：自动获取股息和除净日信息

### 智能分析
- **主力资金追踪**：识别建仓和出货信号，集成基本面分析
- **板块分析**：16个板块涨跌幅排名、技术趋势分析、龙头识别
- **板块轮动河流图**：可视化板块排名变化
- **恒生指数策略**：大模型生成交易策略
- **AI交易分析**：复盘AI推荐策略有效性
- **综合分析系统**：整合大模型建议和ML预测结果，生成实质买卖建议

### 机器学习
- **多周期预测**：基于LightGBM和GBDT+LR预测1天、5天、20天后的涨跌
- **特征工程**：2936个特征（技术指标、基本面、美股市场、情感指标、板块分析、长期趋势）
- **特征选择**：LightGBM使用500个精选特征（F-test+互信息混合），GBDT+LR使用全部2936个特征
- **最新准确率（2026-02-16）**：51.70%（次日）→ 54.64%（一周）→ 59.11%/58.32%（一个月，LightGBM/GBDT+LR）
- **特征重要性分析**：提供模型可解释性

### 模拟交易
- **真实模拟**：基于大模型建议的模拟交易系统
- **风险控制**：自动止损机制
- **详细记录**：完整的交易日志和持仓分析
- **多种策略**：支持保守型、平衡型、进取型投资偏好

## 快速开始

### 环境要求
- Python 3.10 或更高版本
- pip 包管理器

### 安装步骤

```bash
# 1. 克隆项目
git clone https://github.com/wonglaitung/fortune.git
cd fortune

# 2. 安装依赖
pip install -r requirements.txt

# 3. 配置环境变量
# 编辑 set_key.sh 文件，设置邮件和大模型API密钥
source set_key.sh
```

### 使用示例

```bash
# 监控加密货币价格
python crypto_email.py

# 追踪港股主力资金
python hk_smart_money_tracker.py

# 板块分析
python data_services/hk_sector_analysis.py

# 恒生指数价格监控
python hsi_email.py

# 启动模拟交易
python simulation_trader.py

# 训练机器学习模型
python ml_services/ml_trading_model.py --mode train --horizon 20 --model-type both --use-feature-selection

# 预测股票涨跌
python ml_services/ml_trading_model.py --mode predict --horizon 20 --model-type both

# 综合分析（整合大模型建议和ML预测）
python comprehensive_analysis.py
```

## 项目结构

```
fortune/
├── 核心脚本
│   ├── ai_trading_analyzer.py          # AI交易分析器
│   ├── crypto_email.py                 # 加密货币监控器
│   ├── gold_analyzer.py                # 黄金市场分析器
│   ├── hk_ipo_aastocks.py              # IPO信息获取器
│   ├── hk_smart_money_tracker.py       # 主力资金追踪器
│   ├── hsi_email.py                    # 恒生指数监控器
│   ├── simulation_trader.py            # 模拟交易系统
│   ├── comprehensive_analysis.py       # 综合分析脚本
│   └── ...
│
├── 数据服务模块 (data_services/)
│   ├── technical_analysis.py           # 通用技术分析工具
│   ├── fundamental_data.py             # 基本面数据获取器
│   ├── hk_sector_analysis.py           # 板块分析器
│   └── ...
│
## 机器学习模块 (ml_services/)
│   ├── ml_trading_model.py             # 机器学习交易模型
│   ├── ml_prediction_email.py          # 预测邮件发送器
│   ├── us_market_data.py               # 美股市场数据
│   ├── feature_selection.py            # 特征选择模块
│   └── ...
│
├── 大模型服务 (llm_services/)
│   ├── qwen_engine.py                  # Qwen大模型接口
│   └── sentiment_analyzer.py           # 情感分析模块
│
├── 配置文件
│   ├── config.py                       # 全局配置
│   ├── requirements.txt                # 项目依赖
│   └── set_key.sh                      # 环境变量配置
│
└── 数据文件 (data/)
    ├── actual_porfolio.csv             # 实际持仓数据
    ├── ml_trading_model_*.pkl          # 机器学习模型
    └── ...
```

## 技术架构

```
金融信息监控与智能交易系统
│
├── 数据获取层
│   ├── 加密货币数据 (CoinGecko)
│   ├── 港股数据 (yfinance, 腾讯财经, AKShare)
│   ├── 黄金数据 (yfinance)
│   ├── 基本面数据 (AKShare)
│   └── 美股市场数据 (yfinance)
│
├── 数据服务层
│   ├── 技术分析 (RSI、MACD、布林带、ATR等)
│   ├── 基本面分析
│   ├── 板块分析
│   └── 新闻过滤
│
├── 分析层
│   ├── 主力资金追踪
│   ├── AI交易分析
│   ├── 机器学习模型
│   └── 综合分析
│
├── 交易层
│   └── 模拟交易系统
│
└── 服务层
    ├── 大模型服务
    └── 邮件服务
```

## 依赖项

```txt
yfinance        # 金融数据获取
requests        # HTTP请求
pandas          # 数据处理
numpy           # 数值计算
akshare         # 中文财经数据
matplotlib      # 数据可视化
lightgbm        # 机器学习模型
scikit-learn    # 机器学习工具库
```

## 自动化

系统使用 GitHub Actions 进行自动化调度：

| 工作流 | 功能 | 执行时间 |
|--------|------|----------|
| crypto-alert.yml | 加密货币监控 | 每小时 |
| hsi-email-alert-open_message.yml | 恒生指数监控 | 交易时段 |
| smart-money-alert.yml | 主力资金追踪 | 每天 UTC 22:00 |
| ml-prediction-alert.yml | 综合分析 | 每周日 UTC 01:00 |

## 注意事项

1. **数据源限制**：部分数据源可能有访问频率限制
2. **缓存机制**：基本面数据缓存7天，可手动清除
3. **交易时间**：模拟交易系统遵循港股交易时间
4. **风险提示**：本系统仅供学习和研究使用，不构成投资建议
5. **API密钥**：请妥善保管API密钥，不要提交到版本控制

## 项目状态

| 维度 | 状态 | 说明 |
|------|------|------|
| **核心功能** | ✅ 完整 | 数据获取、分析、交易、通知全覆盖 |
| **模块化架构** | ✅ 完成 | data_services、llm_services、ml_services |
| **ML模型** | ✅ 优秀 | 2936特征，准确率最高59.11%（接近业界优秀水平60%） |
| **自动化** | ✅ 稳定 | 4个GitHub Actions工作流正常运行 |
| **文档** | ✅ 完整 | README、IFLOW、分析报告齐全 |
| **数据验证** | ✅ 严格 | 无数据泄漏，时间序列交叉验证 |
| **风险管理** | ⚠️ 可优化 | 可添加VaR、止损止盈、仓位管理 |
| **Web界面** | ❌ 未实现 | 可考虑添加可视化界面 |

## ML模型性能

**最新准确率（2026-02-16）：**

| 预测周期 | LightGBM | GBDT+LR | 说明 |
|---------|----------|---------|------|
| 次日（1天） | 51.70% | 52.28% | 符合弱信号模型预期 |
| 一周（5天） | 54.64% | 53.75% | 中等准确率 |
| 一个月（20天） | 59.11% | 58.32% | **最佳表现，接近业界优秀水平** |

**性能优化历程（2026-02-16）：**
- **超增强正则化优化**：降低一个月模型波动性（±7.17% → ±6.33% / ±6.06%）
- **特征选择优化**：LightGBM使用500个精选特征（准确率+1.48%），GBDT+LR使用全部2936个特征（准确率+0.52%）
- **GBDT+LR修复**：修复缺少技术指标与基本面交互特征问题（准确率从55.94%恢复到58.32%）

**特征类型（2936个）：**
- 技术指标特征（80+个）：RSI、MACD、布林带、ATR等
- 基本面特征：PE、PB、ROE、ROA等
- 美股市场特征（11个）：标普500、纳斯达克、VIX、美国国债收益率
- 股票类型特征（18个）：行业分类、防御性、成长性等
- 情感指标特征（6个）：情感趋势、波动率、变化率
- 板块分析特征（17个）：板块涨跌幅、排名、趋势
- 长期趋势特征（24个）：MA120/250、长期收益率、长期波动率
- 交叉特征（2000+个）：分类特征×数值特征
- 技术指标与基本面交互特征（18个）：RSI×PE、MACD×ROE等

**特征选择策略（2026-02-16）：**
- **LightGBM**：使用500个精选特征（F-test+互信息混合方法）
- **GBDT+LR**：跳过特征选择，使用全部2936个特征
- **差异化原因**：GBDT+LR的LR层需要更多输入维度，对特征选择敏感

**使用建议：**
- ✅ 优先使用一个月模型预测结果（准确率最高）
- ✅ 与手工信号结合使用，不单独依赖
- ✅ 定期重新训练模型（建议每周或每月）
- ✅ 关注高置信度预测（概率 > 60%）
- ⚠️ 注意风险控制，设置合理的止损位

## 邮件通知

系统支持自动邮件通知，包括：

- 💰 加密货币价格更新
- 📋 港股 IPO 信息
- 📊 主力资金追踪报告
- 📈 恒生指数交易信号
- 🥇 黄金市场分析报告
- 🔄 模拟交易通知（买入、卖出、止损等）
- 📊 AI 交易分析报告
- 🤖 机器学习模型预测结果
- 💼 AI 持仓投资分析
- 📊 综合买卖建议

邮件采用统一的表格化样式，清晰易读。

## 数据文件说明

| 文件 | 说明 | 更新频率 |
|------|------|---------|
| `actual_porfolio.csv` | 实际持仓数据 | 手动更新 |
| `simulation_state.json` | 模拟交易状态 | 实时 |
| `simulation_transactions.csv` | 交易历史记录 | 实时 |
| `ml_trading_model_*.pkl` | 机器学习模型 | 按需 |
| `ml_trading_model_*_importance.csv` | 特征重要性排名 | 按需 |
| `fundamental_cache/` | 基本面数据缓存 | 7天有效期 |

## 重要提示

1. **模型性能基准**：
   - 随机/平衡基线：≈50%
   - 常见弱信号：≈51-55%
   - 有意义的改进：≈55-60%
   - 非常好/罕见：≈60-65%
   - 异常高（需怀疑）：>65%

2. **数据验证**：
   - 严格的时间序列交叉验证
   - 无数据泄漏
   - 日期索引保留，按时间顺序排列

3. **风险提示**：
   - 本系统仅供学习和研究使用
   - 不构成投资建议
   - 投资有风险，入市需谨慎

## 未来计划

### 机器学习模型特征工程优化计划

#### 已完成
- [x] 情感趋势特征：情感指标的移动平均（MA3、MA7、MA14）、波动率、变化率
- [x] 多维度情感分析：四维情感评分（Relevance/Impact/Expectation_Gap/Sentiment）
- [x] 长期趋势特征：MA120/250、长期收益率、长期波动率、长期ATR（24个特征）

#### 待实现
- [ ] 主题分布特征：使用LDA对新闻进行主题建模（10个主题）
- [ ] 交互特征：创建主题与情感的交互特征、技术指标与基本面的交互
- [ ] 预期差距特征：计算新闻相对于市场预期的差距
- [ ] 技术动量特征：实现TMA算法特征（趋势斜率、一致性、置信度）
- [x] 特征选择优化：使用F-test + 互信息混合方法（已完成，从2936个特征筛选出500个）
- [ ] 正则化增强：持续优化正则化参数

#### 性能目标
- 一个月模型：从58.97%提升至60%+（业界优秀水平）
- 一周模型：从54.64%提升至55-58%
- 次日模型：从51.70%提升至53-55%

### 其他功能计划
- [ ] Web界面展示信息
- [ ] 风险管理模块优化（VaR、ES、压力测试）
- [ ] 集成深度学习模型（LSTM、Transformer）
- [ ] 实时数据流处理能力
- [ ] 投资组合优化算法
- [ ] 机器学习模型自动超参数调优

### 计划完成度

**分析日期**: 2026-02-16

### 总体完成度

| 分类 | 总数 | 已完成 | 完成率 |
|------|------|--------|--------|
| **已完成计划（2026-02-14前）** | 6 | 6 | 100% |
| **ML特征工程优化** | 11 | 6 | 55% |
| **其他功能计划** | 16 | 0 | 0% |
| **总计** | 33 | 12 | 36% |

### 已完成计划（100%）
1. ✅ 机器学习模型准确率优化（目标：55-60%）→ 一个月模型已达59.11%
2. ✅ 集成量化回测框架
3. ✅ 添加风险管理和止损止盈优化功能
4. ✅ 添加更多技术分析指标和信号（50+）
5. ✅ 实现异常检测和风险预警系统
6. ✅ 添加数据存储和历史分析功能

### ML特征工程优化（55%）
- ✅ 情感趋势特征（MA3/MA7/MA14、波动率、变化率）
- ✅ 多维度情感分析（四维情感评分）
- ✅ 长期趋势特征（MA120/250、长期收益率、长期波动率、长期ATR）
- ✅ 时间序列交叉验证（5折时间序列分割）
- ✅ 正则化增强（树深度4、min_child_samples30、L1/L2=0.1）
- ✅ **特征选择优化（F-test + 互信息）** - 从2936个特征筛选出500个（2026-02-16）
- ✅ **GBDT+LR特征选择修复** - 修复缺少技术指标与基本面交互特征问题（2026-02-16）
- ❌ 主题分布特征（LDA主题建模）
- ❌ 交互特征（主题×情感、技术指标×基本面）
- ❌ 预期差距特征
- ❌ 技术动量特征（TMA算法）

### 自发优化项目（未在原计划中）
- 长期趋势特征（24个特征）
- VaR风险价值计算（1日、5日、20日）
- 综合分析系统（整合大模型建议和ML预测）
- 正则化配置差异化（LightGBM一个月模型0.25，GBDT+LR一个月模型0.22）
- 六层风险管理框架
- **特征选择优化（2026-02-16）** - 使用F-test+互信息混合方法，特征减少83%
- **差异化特征选择策略** - LightGBM 500特征，GBDT+LR 2936特征
- **GBDT+LR修复** - 添加create_technical_fundamental_interactions调用

### 优先级建议

**高优先级**：
1. ✅ 完成一个月模型的过拟合控制（已降至±6.90%/±7.31%）
2. ✅ 实现特征选择优化（已完成，从2936个特征筛选出500个）
3. ✅ 修复GBDT+LR准确率下降问题（已完成，准确率恢复至58.32%）
4. 实现主题分布特征（LDA主题建模）

**中优先级**：
5. 实现投资组合优化算法
6. 机器学习模型自动超参数调优
7. 机器学习预测结果可视化优化

**低优先级**：
8. 实现Web界面
9. 集成深度学习模型

## 贡献指南

欢迎提交 Issue 和 Pull Request！

## 许可证

MIT License

## 联系方式

如有问题，请提交 Issue 或联系项目维护者。