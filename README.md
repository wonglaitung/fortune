# 金融信息监控与模拟交易系统

## 项目简介

本项目是一个综合性的金融信息监控与模拟交易系统，旨在为投资者提供全面的市场分析和交易策略验证工具。系统集成了多种金融数据源，利用技术分析、资金流向分析和大模型智能判断，帮助用户更好地理解市场动态并验证投资策略。

系统包含七个核心组件：
1. **加密货币价格监控器** - 实时获取主流加密货币的价格信息并通过邮件发送
2. **港股IPO信息获取器** - 爬取AAStocks网站获取最新的港股IPO信息
3. **港股主力资金追踪器** - 分析港股市场主力资金动向，识别建仓和出货信号
4. **港股主力资金历史数据分析器** - 分析历史数据中的信号模式
5. **港股模拟交易系统** - 基于主力资金追踪器的分析结果和大模型判断进行模拟交易
6. **个股新闻获取器** - 获取自选股相关的最新财经新闻
7. **黄金市场分析器** - 分析黄金市场价格趋势和技术指标

## 系统架构

```
金融信息监控与模拟交易系统
├── 数据获取层
│   ├── 加密货币价格监控器 (@crypto_email.py)
│   ├── 港股IPO信息获取器 (@hk_ipo_aastocks.py)
│   └── 个股新闻获取器 (@batch_stock_news_fetcher.py)
├── 分析层
│   ├── 港股主力资金追踪器 (@hk_smart_money_tracker.py)
│   ├── 港股主力资金历史数据分析 (@hk_smart_money_historical_analysis.py)
│   └── 黄金市场分析器 (@gold_analyzer.py)
└── 交易层
    └── 港股模拟交易系统 (@simulation_trader.py)
```

## 核心功能

### 1. 数据获取与监控
- **实时数据获取**：获取加密货币和港股市场的实时价格数据
- **网络爬虫**：从AAStocks等网站获取IPO信息
- **新闻获取**：获取自选股相关的最新财经新闻
- **自动邮件通知**：将重要信息通过邮件发送给用户

### 2. 智能分析
- **技术指标分析**：MACD、RSI、OBV、均线等技术指标计算
- **资金流向分析**：沪港通/深港通南向资金数据获取与分析
- **信号识别**：自动识别主力资金建仓和出货信号
- **历史数据分析**：分析历史数据中的信号模式
- **新闻分析**：利用大模型分析新闻与股票的相关性
- **黄金市场分析**：获取黄金相关资产和宏观经济数据，进行技术分析

### 3. 模拟交易
- **大模型集成**：真实调用大模型进行股票分析和交易决策
- **结构化输出**：要求大模型以固定JSON格式输出买卖信号
- **风险偏好支持**：支持保守型、平衡型、进取型投资者设置
- **严格遵循**：严格按照大模型建议执行交易，无随机操作
- **状态持久化**：交易记录和状态自动保存，支持中断后继续

## 安装与配置

### 安装依赖

```bash
# 基础依赖
pip install requests beautifulsoup4 pandas

# 港股分析组件依赖
pip install yfinance akshare matplotlib numpy

# 模拟交易系统依赖
pip install schedule

# 黄金分析器依赖
pip install yfinance pandas numpy

# 新闻获取器依赖
pip install akshare yfinance
```

### 环境变量配置

设置以下环境变量以启用邮件发送功能和大模型服务：

- `YAHOO_EMAIL`：发件人邮箱地址
- `YAHOO_APP_PASSWORD`：发件人邮箱应用密码
- `RECIPIENT_EMAIL`：收件人邮箱地址（可选，多个收件人用逗号分隔）
- `QWEN_API_KEY`：大模型API密钥（用于模拟交易系统和资金追踪器）
- `YAHOO_SMTP`：SMTP服务器地址（可选，默认为smtp.gmail.com）

## 组件详细说明

### 加密货币价格监控器 (@crypto_email.py)
- 实时获取比特币和以太坊的价格信息（USD和HKD）
- 支持获取24小时价格变化、市值和交易量
- 自动发送价格更新邮件
- 支持多个收件人

### 港股IPO信息获取器 (@hk_ipo_aastocks.py)
- 爬取AAStocks网站获取最新的港股IPO信息
- 提取公司名称、上市日期、行业、招股日期、每手股数、招股价格、入场费、暗盘日期等信息
- 保存IPO数据到CSV文件
- 发送IPO信息邮件

### 港股主力资金追踪器 (@hk_smart_money_tracker.py)
- 实时获取港股股票价格和交易数据
- 分析股票的技术指标（MACD、RSI、均线偏离、OBV等）
- 获取沪港通/深港通南向资金数据
- 识别主力资金建仓和出货信号
- 生成可视化图表
- 发送详细分析报告邮件
- 结合个股相关新闻进行综合分析

### 港股主力资金历史数据分析 (@hk_smart_money_historical_analysis.py)
- 分析指定时间段内的历史数据
- 识别历史上的建仓和出货信号日期
- 生成历史信号报告Excel文件
- 支持自定义分析时间范围

### 港股模拟交易系统 (@simulation_trader.py)
- 基于hk_smart_money_tracker的分析结果和大模型判断进行模拟交易
- 每15分钟执行一次交易分析
- 真实调用大模型进行股票分析，并要求以固定JSON格式输出买卖信号
- 支持保守型、平衡型、进取型投资者风险偏好设置
- 严格按照大模型建议执行交易，无随机操作
- 交易记录和状态自动保存，支持中断后继续
- 完整的交易日志记录

### 黄金市场分析器 (@gold_analyzer.py)
- 实时获取COMEX黄金期货和黄金ETF价格数据
- 计算技术指标（MACD、RSI、均线、布林带等）
- 分析黄金价格趋势和支撑阻力位
- 识别买卖信号
- 生成详细的分析报告
- 集成大模型深度分析黄金市场

### 个股新闻获取器 (@batch_stock_news_fetcher.py)
- 获取自选股相关的最新财经新闻
- 使用AKShare获取个股新闻数据
- 利用大模型分析新闻与股票的相关性
- 按时间由近到远排列新闻
- 将新闻数据持久化保存到CSV文件
- 支持定时运行模式

## 使用方法

### 基础组件使用

```bash
# 加密货币价格监控器
python crypto_email.py

# 港股IPO信息获取器
python hk_ipo_aastocks.py

# 港股主力资金追踪器
python hk_smart_money_tracker.py

# 港股主力资金历史数据分析
python hk_smart_money_historical_analysis.py --start-date 2025-01-01 --end-date 2025-09-30

# 黄金市场分析器
python gold_analyzer.py

# 个股新闻获取器
python batch_stock_news_fetcher.py

# 个股新闻获取器（定时运行模式）
python batch_stock_news_fetcher.py --schedule
```

### 模拟交易系统使用

```bash
# 运行模拟交易系统（默认90天）
python simulation_trader.py

# 运行指定天数的模拟交易
python simulation_trader.py --duration-days 30
```

## 配置参数

### 港股主力资金追踪器参数
在`hk_smart_money_tracker.py`代码顶部可以调整以下参数：

- `WATCHLIST`：自选股票列表
- `DAYS_ANALYSIS`：分析窗口天数
- `VOL_WINDOW`：成交量分析窗口
- `PRICE_WINDOW`：价格分析窗口
- `BUILDUP_MIN_DAYS`：建仓信号最小确认天数
- `DISTRIBUTION_MIN_DAYS`：出货信号最小确认天数
- 阈值参数：
  - `PRICE_LOW_PCT`：建仓信号价格百分位阈值
  - `PRICE_HIGH_PCT`：出货信号价格百分位阈值
  - `VOL_RATIO_BUILDUP`：建仓信号量比阈值
  - `VOL_RATIO_DISTRIBUTION`：出货信号量比阈值
  - `SOUTHBOUND_THRESHOLD`：南向资金阈值

### 模拟交易系统参数
在`simulation_trader.py`文件中可以调整以下参数：

- `investor_type`：投资者风险偏好（"保守型"、"平衡型"、"进取型"）
- `initial_capital`：初始资金（默认100万港元）
- `analysis_frequency`：执行频率（默认每15分钟执行一次交易分析）

### 个股新闻获取器参数
在`batch_stock_news_fetcher.py`文件中可以使用以下参数：

- `--schedule` 或 `-s`：启用定时任务模式（默认：单次运行）
- 定时任务模式下，程序会在香港时间上午9点和下午1点半各运行一次

## 信号说明

### 建仓信号
当股价处于相对低位、成交量显著放大、南向资金净流入超过阈值，且满足至少一个辅助技术指标条件时触发。

### 出货信号
当股价处于相对高位、成交量剧烈放大、南向资金净流出超过阈值，且满足至少一个辅助技术指标条件时触发。

## 输出文件

### 数据获取组件
- 控制台输出：价格信息预览
- 邮件报告：包含详细的价格信息和IPO信息
- CSV文件：保存个股新闻数据

### 分析组件
- Excel报告：详细的分析结果
- 可视化图表：保存在hk_smart_charts目录下
- 邮件报告：包含详细指标说明和分析结果
- CSV文件：保存个股新闻数据

### 模拟交易系统
- 状态文件：data/simulation_state.json（保存交易状态，支持中断后继续）
- 交易日志：data/simulation_trade_log.txt（详细交易日志记录）
- 交易历史：data/simulation_transactions.csv（交易历史记录）
- 投资组合历史：data/simulation_portfolio.csv（投资组合价值变化记录）

## 自动化调度

项目支持通过GitHub Actions进行自动化调度：

1. **加密货币价格监控**：默认每天UTC时间0:00、8:00和16:00执行（即北京时间8:00、16:00和0:00）
2. **港股IPO信息获取**：默认每天UTC时间1:00执行（即北京时间9:00）
3. **港股主力资金追踪**：默认每天UTC时间0:00执行（即北京时间8:00）
4. **港股主力资金历史数据分析**：可通过手动执行或设置额外的调度任务来定期分析历史数据
5. **港股模拟交易系统**：可在本地运行，支持长时间模拟交易测试

## 注意事项

- 本工具仅用于数据分析和参考，不构成投资建议
- 投资者应结合基本面分析和风险管理进行决策
- 南向资金数据可能存在延迟或不准确的情况
- 建议定期更新依赖库以获取最新数据
- 爬虫功能可能因网站结构变化而失效，需要及时调整
- 模拟交易系统仅用于验证交易策略，不保证实际交易效果