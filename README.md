# 金融信息监控系统

## 项目简介

本项目是一个综合性的金融信息监控系统，包含三个主要组件：

1. **加密货币价格监控器** - 实时获取比特币和以太坊的价格信息并通过邮件发送
2. **港股IPO信息获取器** - 爬取AAStocks网站获取最新的港股IPO信息
3. **港股主力资金追踪器** - 分析港股市场主力资金动向，识别建仓和出货信号（包含实时分析和历史数据分析）

## 目录

- [功能特性](#功能特性)
  - [加密货币价格监控器](#加密货币价格监控器)
  - [港股IPO信息获取器](#港股ipo信息获取器)
  - [港股主力资金追踪器](#港股主力资金追踪器)
  - [港股主力资金历史数据分析](#港股主力资金历史数据分析)
- [安装依赖](#安装依赖)
- [使用方法](#使用方法)
  - [加密货币价格监控器](#加密货币价格监控器-1)
  - [港股IPO信息获取器](#港股ipo信息获取器-1)
  - [港股主力资金追踪器](#港股主力资金追踪器-1)
- [配置说明](#配置说明)
  - [环境变量配置](#环境变量配置)
  - [各脚本特定配置](#各脚本特定配置)
- [信号说明](#信号说明)
  - [建仓信号](#建仓信号)
  - [出货信号](#出货信号)
- [输出说明](#输出说明)
  - [加密货币价格监控器](#加密货币价格监控器-2)
  - [港股IPO信息获取器](#港股ipo信息获取器-2)
  - [港股主力资金追踪器](#港股主力资金追踪器-2)
- [自动化调度](#自动化调度)
- [注意事项](#注意事项)

## 功能特性

### 加密货币价格监控器 (@crypto_email.py)
- 实时获取比特币和以太坊的价格信息（USD和HKD）
- 支持获取24小时价格变化、市值和交易量
- 自动发送价格更新邮件
- 支持多个收件人

### 港股IPO信息获取器 (@hk_ipo_aastocks.py)
- 爬取AAStocks网站获取最新的港股IPO信息
- 提取公司名称、上市日期、行业、招股日期、每手股数、招股价格、入场费、暗盘日期等信息
- 保存IPO数据到CSV文件
- 发送IPO信息邮件

### 港股主力资金追踪器 (@hk_smart_money_tracker.py)
- 实时获取港股股票价格和交易数据
- 分析股票的技术指标（MACD、RSI、均线偏离、OBV等）
- 获取沪港通/深港通南向资金数据
- 识别主力资金建仓和出货信号
- 生成可视化图表
- 发送详细分析报告邮件
- 改进了南向资金数据获取逻辑，增加容错处理
- 调整了信号检测阈值，提高信号检测的敏感性
- 增加了更多信号检测条件（MACD、RSI、OBV等技术指标）
- 改进了数据质量检查，提高分析准确性

### 港股主力资金历史数据分析 (@hk_smart_money_historical_analysis.py)
- 分析指定时间段内的历史数据
- 识别历史上的建仓和出货信号日期
- 生成历史信号报告Excel文件
- 支持自定义分析时间范围
- 与实时分析脚本保持一致的信号检测逻辑

## 安装依赖

```bash
# 基础依赖
pip install requests beautifulsoup4 pandas

# 港股主力资金追踪器额外依赖
pip install yfinance akshare matplotlib numpy
```

## 使用方法

### 加密货币价格监控器

```bash
python crypto_email.py
```

### 港股IPO信息获取器

```bash
python hk_ipo_aastocks.py
```

### 港股主力资金追踪器

```bash
python hk_smart_money_tracker.py
```

## 配置说明

### 环境变量配置

设置以下环境变量以启用邮件发送功能：

- `YAHOO_EMAIL`：发件人邮箱地址
- `YAHOO_APP_PASSWORD`：发件人邮箱应用密码
- `RECIPIENT_EMAIL`：收件人邮箱地址（可选，多个收件人用逗号分隔）

### 各脚本特定配置

#### 加密货币价格监控器

- 默认获取比特币和以太坊的价格信息
- 可通过修改`get_cryptocurrency_prices`函数参数来调整获取的额外信息

#### 港股IPO信息获取器

- 数据来源：AAStocks网站
- 自动保存数据到CSV文件
- 支持邮件发送功能

#### 港股主力资金追踪器

在代码顶部可以调整以下参数：

- `WATCHLIST`：自选股票列表
- `DAYS_ANALYSIS`：分析窗口天数
- `VOL_WINDOW`：成交量分析窗口
- `PRICE_WINDOW`：价格分析窗口
- `BUILDUP_MIN_DAYS`：建仓信号最小确认天数
- `DISTRIBUTION_MIN_DAYS`：出货信号最小确认天数
- 阈值参数：
  - `PRICE_LOW_PCT`：建仓信号价格百分位阈值（默认40.0，原为30.0）
  - `PRICE_HIGH_PCT`：出货信号价格百分位阈值（默认60.0，原为70.0）
  - `VOL_RATIO_BUILDUP`：建仓信号量比阈值（默认1.3，原为1.5）
  - `VOL_RATIO_DISTRIBUTION`：出货信号量比阈值（默认2.0，原为2.5）
  - `SOUTHBOUND_THRESHOLD`：南向资金阈值（默认3000.0万，原为5000.0万）

## 信号说明

### 建仓信号

当以下条件同时满足时触发：

- 股价处于相对低位（默认40%以下，原为30%）
- 成交量显著放大（量比>1.3，原为1.5）
- 南向资金净流入超过阈值（默认3000万，原为5000万）
- 至少满足一个辅助条件（MACD线上穿信号线、RSI<30、OBV>0）
- 连续达到最小确认天数（默认3天）

### 出货信号

当以下条件同时满足时触发：

- 股价处于相对高位（默认60%以上，原为70%）
- 成交量剧烈放大（量比>2.0，原为2.5）
- 南向资金净流出超过阈值（默认-3000万，原为-5000万）
- 当日收盘价下行
- 至少满足一个辅助条件（MACD线下穿信号线、RSI>70、OBV<0）
- 连续达到最小确认天数（默认2天）

## 输出说明

### 加密货币价格监控器

1. 控制台输出：价格信息预览
2. 邮件报告：包含比特币和以太坊的详细价格信息

### 港股IPO信息获取器

1. 控制台输出：IPO信息表格
2. CSV文件：hk_ipo_aastocks_data_\*.csv
3. 邮件报告：包含IPO信息的HTML邮件

### 港股主力资金追踪器

1. 控制台输出：股票分析结果和信号提示
2. Excel报告：hk_smart_money_report.xlsx
3. 可视化图表：保存在hk_smart_charts目录下
4. 邮件报告：包含详细指标说明和分析结果

## 自动化调度

项目支持通过GitHub Actions进行自动化调度：

1. **加密货币价格监控**：默认每天UTC时间0:00、8:00和16:00执行
2. **港股IPO信息获取**：默认每天UTC时间1:00执行
3. **港股主力资金追踪**：默认每天UTC时间2:00执行

## 注意事项

- 本工具仅用于数据分析和参考，不构成投资建议
- 投资者应结合基本面分析和风险管理进行决策
- 南向资金数据可能存在延迟或不准确的情况
- 建议定期更新依赖库以获取最新数据
- 爬虫功能可能因网站结构变化而失效，需要及时调整